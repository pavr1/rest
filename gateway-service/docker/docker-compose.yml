# Gateway Service Docker Compose
# =============================================================================
# Gateway pings all business services via health endpoints to check availability.
# Use root Makefile: make fresh (handles startup order)
# =============================================================================

services:
  gateway-service:
    build:
      context: ../..
      dockerfile: gateway-service/docker/Dockerfile
    container_name: barrest_gateway_service
    restart: unless-stopped
    environment:
      # Server Configuration
      - SERVER_HOST=0.0.0.0
      - SERVER_PORT=8082
      # Service URLs (used for proxying and health checks)
      - DATA_SERVICE_URL=http://barrest_data_service:8086
      - SESSION_SERVICE_URL=http://barrest_session_service:8087
      # Future service URLs (add as services are created):
      # - MENU_SERVICE_URL=http://barrest_menu_service:8088
      # - ORDERS_SERVICE_URL=http://barrest_orders_service:8089
      # - INVENTORY_SERVICE_URL=http://barrest_inventory_service:8090
      # - PAYMENT_SERVICE_URL=http://barrest_payment_service:8091
      # - INVOICE_SERVICE_URL=http://barrest_invoice_service:8092
      # - KARAOKE_SERVICE_URL=http://barrest_karaoke_service:8093
      # - PROMOTION_SERVICE_URL=http://barrest_promotion_service:8094
      # - CUSTOMER_SERVICE_URL=http://barrest_customer_service:8095
    ports:
      - "8082:8082"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8082/api/v1/gateway/p/health"]
      interval: 1s
      timeout: 5s
      retries: 3
      start_period: 10s
    networks:
      - docker_barrest_network

networks:
  docker_barrest_network:
    external: true
