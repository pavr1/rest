<!-- Suppliers Page Partial -->
<style>
    .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
    .page-title { font-family: 'Playfair Display', serif; font-size: 1.75rem; margin: 0; }
    .data-card { background: white; border-radius: var(--border-radius); box-shadow: var(--shadow-light); overflow: hidden; }
    .data-card-header { padding: 1rem 1.5rem; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; }
    .data-table { width: 100%; margin: 0; }
    .data-table th { background: #f8f9fa; padding: 0.75rem 1rem; font-weight: 600; font-size: 0.85rem; color: var(--text-secondary); text-transform: uppercase; border-bottom: 2px solid #e9ecef; }
    .data-table td { padding: 1rem; vertical-align: middle; border-bottom: 1px solid #e9ecef; }
    .data-table tbody tr:hover { background: #f8f9fa; }
    .action-btns { display: flex; gap: 0.5rem; }
    .btn-action { width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 6px; font-size: 0.85rem; }
    .empty-state, .loading-state { text-align: center; padding: 3rem 1rem; color: var(--text-secondary); }
    .empty-state i { font-size: 3rem; margin-bottom: 1rem; opacity: 0.5; }
    .supplier-info { display: flex; flex-direction: column; }
    .supplier-name { font-weight: 600; color: var(--text-primary); }
    .supplier-contact { font-size: 0.85rem; color: var(--text-secondary); }
</style>

<div class="page-header">
    <h1 class="page-title">Suppliers</h1>
    <button class="btn btn-primary" id="addSupplierBtn">
        <i class="fas fa-plus me-2"></i>Add Supplier
    </button>
</div>

<div class="data-card">
    <div class="data-card-header">
        <h5 class="mb-0">All Suppliers</h5>
        <button class="btn btn-outline-secondary btn-sm" id="refreshBtn"><i class="fas fa-sync-alt"></i></button>
    </div>

    <div id="tableContainer">
        <div class="loading-state" id="loadingState">
            <div class="spinner-border text-primary mb-3"></div>
            <p>Loading suppliers...</p>
        </div>

        <div class="empty-state d-none" id="emptyState">
            <i class="fas fa-truck"></i>
            <h5>No suppliers yet</h5>
            <p>Create your first supplier to get started.</p>
        </div>

        <table class="data-table d-none" id="dataTable">
            <thead>
                <tr>
                    <th>Supplier</th>
                    <th>Contact Person</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th width="120">Actions</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="supplierModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Add Supplier</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="supplierForm">
                <div class="modal-body">
                    <input type="hidden" id="supplierId">
                    <div class="mb-3">
                        <label class="form-label">Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="supplierName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Contact Person</label>
                        <input type="text" class="form-control" id="contactName">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <input type="text" class="form-control" id="supplierPhone">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="supplierEmail">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <textarea class="form-control" id="supplierAddress" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="saveBtn">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
(function() {
    let suppliers = [];
    let modal = null;
    let editingId = null;

    function init() {
        modal = new bootstrap.Modal(document.getElementById('supplierModal'));
        setupEventListeners();
        loadSuppliers();
    }

    function setupEventListeners() {
        document.getElementById('addSupplierBtn')?.addEventListener('click', () => openModal());
        document.getElementById('refreshBtn')?.addEventListener('click', () => loadSuppliers());
        document.getElementById('supplierForm')?.addEventListener('submit', (e) => { e.preventDefault(); saveSupplier(); });
    }

    async function loadSuppliers() {
        showLoading();
        try {
            const token = window.authService.getToken();
            const resp = await fetch(CONFIG.INVENTORY.suppliers, { headers: { 'Authorization': `Bearer ${token}` } });
            if (!resp.ok) throw new Error('Failed to load');
            const result = await resp.json();
            suppliers = result.data?.suppliers || result.suppliers || [];
            renderTable();
        } catch (e) {
            console.error('Error:', e);
            Swal.fire('Error', 'Failed to load suppliers', 'error');
            showEmpty();
        }
    }

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        const table = document.getElementById('dataTable');
        const empty = document.getElementById('emptyState');
        document.getElementById('loadingState').classList.add('d-none');

        if (!suppliers.length) { table.classList.add('d-none'); empty.classList.remove('d-none'); return; }

        empty.classList.add('d-none');
        table.classList.remove('d-none');
        tbody.innerHTML = suppliers.map(supplier => `
            <tr>
                <td>
                    <div class="supplier-info">
                        <div class="supplier-name">${escapeHtml(supplier.name)}</div>
                        ${supplier.address ? `<div class="supplier-contact">${escapeHtml(supplier.address)}</div>` : ''}
                    </div>
                </td>
                <td>${escapeHtml(supplier.contact_name || '-')}</td>
                <td>${escapeHtml(supplier.phone || '-')}</td>
                <td>${escapeHtml(supplier.email || '-')}</td>
                <td>
                    <div class="action-btns">
                        <button class="btn btn-outline-primary btn-action" onclick="window.supplierPage.edit('${supplier.id}')" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger btn-action" onclick="window.supplierPage.delete('${supplier.id}')" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                </td>
            </tr>
        `).join('');
    }

    function showLoading() {
        document.getElementById('loadingState').classList.remove('d-none');
        document.getElementById('emptyState').classList.add('d-none');
        document.getElementById('dataTable').classList.add('d-none');
    }

    function showEmpty() {
        document.getElementById('loadingState').classList.add('d-none');
        document.getElementById('emptyState').classList.remove('d-none');
        document.getElementById('dataTable').classList.add('d-none');
    }

    function openModal(supplier = null) {
        editingId = supplier?.id || null;
        document.getElementById('modalTitle').textContent = supplier ? 'Edit Supplier' : 'Add Supplier';
        document.getElementById('supplierId').value = supplier?.id || '';
        document.getElementById('supplierName').value = supplier?.name || '';
        document.getElementById('contactName').value = supplier?.contact_name || '';
        document.getElementById('supplierPhone').value = supplier?.phone || '';
        document.getElementById('supplierEmail').value = supplier?.email || '';
        document.getElementById('supplierAddress').value = supplier?.address || '';
        modal.show();
    }

    async function saveSupplier() {
        const btn = document.getElementById('saveBtn');
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

        try {
            const token = window.authService.getToken();
            const data = {
                name: document.getElementById('supplierName').value,
                contact_name: document.getElementById('contactName').value,
                phone: document.getElementById('supplierPhone').value,
                email: document.getElementById('supplierEmail').value,
                address: document.getElementById('supplierAddress').value
            };
            const url = editingId ? `${CONFIG.INVENTORY.suppliers}/${editingId}` : CONFIG.INVENTORY.suppliers;
            const resp = await fetch(url, {
                method: editingId ? 'PUT' : 'POST',
                headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if (!resp.ok) throw new Error((await resp.json()).message || 'Failed');
            modal.hide();
            Swal.fire({ icon: 'success', title: 'Saved!', timer: 1500, showConfirmButton: false });
            await loadSuppliers();
        } catch (e) {
            Swal.fire('Error', e.message, 'error');
        } finally {
            btn.disabled = false;
            btn.innerHTML = 'Save';
        }
    }

    async function deleteSupplier(id) {
        const supplier = suppliers.find(s => s.id === id);
        const result = await Swal.fire({
            title: 'Delete?', text: `Delete "${supplier?.name}"?`, icon: 'warning',
            showCancelButton: true, confirmButtonColor: '#dc3545', confirmButtonText: 'Delete'
        });
        if (!result.isConfirmed) return;
        try {
            const token = window.authService.getToken();
            const resp = await fetch(`${CONFIG.INVENTORY.suppliers}/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
            if (!resp.ok) throw new Error('Failed');
            Swal.fire({ icon: 'success', title: 'Deleted!', timer: 1500, showConfirmButton: false });
            await loadSuppliers();
        } catch (e) { Swal.fire('Error', e.message, 'error'); }
    }

    function escapeHtml(text) { if (!text) return ''; const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }

    // Expose functions globally for onclick handlers
    window.supplierPage = {
        edit: (id) => { const supplier = suppliers.find(s => s.id === id); if (supplier) openModal(supplier); },
        delete: deleteSupplier
    };

    init();
})();
</script>
